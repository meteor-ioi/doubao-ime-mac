# PRD: 语音输入文本增量更新优化

## 背景

语音输入时，ASR 服务会持续返回中间识别结果（InterimResult），每次返回都包含从开始到当前的完整识别文本。

## 问题描述

1. **文本闪烁**：每次收到 ASR 中间结果时，整段文字先被删除再重新输入，导致视觉闪烁
2. **内容丢失风险**：当说话内容过长时，可能出现前面已确认的文字被删除的情况

## 需求

### 功能需求

1. 实现增量文本更新机制
2. 只更新发生变化的部分，保留未变化的前缀
3. 减少键盘事件数量，降低闪烁感

### 技术方案

使用前缀匹配算法实现增量更新：

1. 计算新旧文本的最长公共前缀
2. 只删除旧文本中超出公共前缀的部分
3. 只追加新文本中超出公共前缀的部分

### 示例

| 转换 | 修改前 | 修改后 |
|-----|--------|--------|
| "今天" → "今天天气" | 删 2 字，输 4 字 | 追加 "天气" (2 字) |
| "今天天气" → "今天天气很好" | 删 4 字，输 6 字 | 追加 "很好" (2 字) |
| "今天" → "明天" | 删 2 字，输 2 字 | 删 1 字，追加 "明" |

## 验收标准

1. 语音输入时文本闪烁明显减少
2. 新识别的文字平滑追加到现有文本后
3. 编译通过，无新增错误

## 实现状态

- [x] 代码实现完成
- [x] 编译验证通过
- [ ] 用户手动测试验证
